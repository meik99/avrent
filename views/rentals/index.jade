extends ../layout

block content
    div.mdl-grid
        div.mdl-cell.mdl-cell--12-col
            h4= "Ger채t verleihen"
        div.mdl-cell.mdl-cell--12-col
            div.mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                input#equipment(disabled=true, readonly=true, type="text", value="#{equipmentName}").mdl-textfield__input
                label(for="equipment").mdl-textfield__label= "Ger채t"
        div.mdl-cell.mdl-cell--12-col
            div.mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                input#pupil(type="text").mdl-textfield__input
                label(for="pupil").mdl-textfield__label= "Sch체lerIn"
        div.mdl-cell.mdl-cell--12-col
            select(id="clazzSelect", onchange="updateClazzname()", onclick="updateClazzname()").dropdown
                option(value="")="Bitte ausw채hlen"
                each clazz in classes
                    option(value="#{clazz.name}")= clazz.name
        div.mdl-cell.mdl-cell--12-col
            div#clazzDiv.mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                input#clazz(type="text").mdl-textfield__input
                label(for="clazz").mdl-textfield__label= "Klasse"
        div.mdl-cell.mdl-cell--12-col
            div.date-label= "Reservieren bis"
            input#dateTo(readonly=true)
        div.mdl-cell.mdl-cell--12-col
            button(onclick="rent()").mdl-button.mdl-js-button.mdl-js-ripple-effect.mdl-button--accent.mdl-button--raised= "Reservieren"

    script.
        (function () {
            var datePreset = new Date((new Date().getTime() + 1000 * 60 * 60 * 24 * 7 * 1));
            $("#dateTo").data("data-value", datePreset.getFullYear() + "/" + datePreset.getMonth() + "/" + datePreset.getDay());
            $("#dateTo").pickadate({
                format: "yyyy-mm-dd"
            });
            $("#dateTo").data("data-value", datePreset.getFullYear() + "/" + datePreset.getMonth() + "/" + datePreset.getDay());

        })();

        function updateClazzname() {
            var clazzSelect = document.getElementById("clazzSelect");
            var name = clazzSelect.options[clazzSelect.selectedIndex].value;

            $("#clazz").val(name);

            if(name && name.length > 0)
                $("#clazzDiv").addClass("is-dirty");
            else
                $("#clazzDiv").removeClass("is-dirty");
        }

        function rent() {
            var equipmentName = $("#equipment").val();
            var pupilName = $("#pupil").val();
            var clazzName = $("#clazz").val();
            var dateTo = $("#dateTo").val();

            console.log(dateTo);

            $.ajax({
                method: "POST",
                url: "/rentals/",
                data:{
                    equipmentName: equipmentName,
                    pupilName: pupilName,
                    clazzName: clazzName,
                    dateTo: dateTo
                }
            }).done(function (data) {
                if(data.error){
                    alert(data.error);
                }else{
                    location.href = "/";
                }
            });
        }